<!DOCTYPE html>
<html>
    <header>
        <title>Boozify</title>
        <link rel="icon" type="image/png" src="../static/images/favicon.png">
        <link rel="stylesheet" href="../static/css/web.css">
    </header>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script >

        function SelectQueryType(clicked_id){
            document.getElementsByClassName("chooseOne")[0].innerHTML = clicked_id;
            document.getElementsByClassName("searchQuery")[0].disabled = false;
            seedString = clicked_id;
        }

        function SearchInput(){
            document.getElementById("power_hour").disabled = false;
        }
        function MakePowerHour() {
            var id_list = new Array();
            var song_list = new Array();
            var success = false;
            fetch("/get-link", {
                method: "POST",
                headers: new Headers({
                    "content-type": "application/json"
                }),
                body: JSON.stringify({
                    "seed": seedString,
                    "search": document.getElementById('search').value,
                })
            })
            .then(function(response) {
                console.log(response);
                response.json().then( data => {//function(data) {
                    console.log("list data");
                    console.log(data);
                    console.log("end data list")
                    for (song_id  of data[0].ids) {
                        console.log(song_id);
                        //id_list.push(song_id);
                    }               
                    /* For debugging i am caching a list */ 
                    for(var i = 0; i < 12; i ++){
                        id_list.push("oa7JRuLEp-w");
                        song_list.push("Tessellate - Tokyo Police Club");
                        //https://www.youtube.com/watch?v=oa7JRuLEp-w
                        id_list.push("ZAxRozTgoXM");
                        song_list.push("Wait Up - Tokyo Police Club");
                        id_list.push("smqNtBXN5Mc");
                        song_list.push("Bambi - Tokyo Police Club");

                        id_list.push("1KGCAffvGIw");
                        song_list.push("Your English is Good - Tokyo Police Club");

                        id_list.push("4MG6rKuCfyo");
                        song_list.push("Argentina - Tokyo Police Club");

                    }
                   /* DEBUG */
                   //var i = 1;
                    //for (song_name of data[1].names){
                        //var new_songname = song_name.replace("-", "by")
                       // song_list.push(i + ". " + new_songname);
                       //i++;
                    //}
                    
                    console.log(song_list);
                    if (id_list.length > 0) {
                      
                        //player.cueVideoById({videoId:id_list[song_num], endSeconds:60, "medium"});
                        var success = true;
                        //document.getElementById("player").style.display = "flex";
                       // document.getElementById("deactivate").disabled = false;
                       //now move to new page with power hour
                        
                        sessionStorage.setItem("id_list", JSON.stringify(id_list));
                        sessionStorage.setItem("song_list", JSON.stringify(song_list));
                        window.location = '/powerhour';
                    }else{
                        throw "Search results empty";
                    }
                    //document.getElementById("player").src = data['link'];
                });
            })
            .catch(window.alert(error));
           
            
        }
        /*
        function Move(){
            var seedString = document.getElementsByClassName("chooseOne")[0].innerHTML;
            //assert that value is not empty
            var searchQuery = document.getElementById("search").value;
            if (searchQuery == ""){
                alert("Please Enter a valid " + seedString + " in the search bar");
            }
            else{
                sessionStorage.setItem("seedString", seedString);
                sessionStorage.setItem("searchQuery", searchQuery);
            }
            window.location = '/powerhour';
        }
        */
    </script>

    <body style="background-color:darkslategrey">
        <div class="logo">
            <img class="boozify_logo" src="/static/images/logo2.png" width="400">
        </div>
        <div class="search">
            <div class="dropdown">
                <button class="chooseOne"> (Choose One)  </button>
                <div class="options">
                    <a id="Artist" href="#" onclick="SelectQueryType(this.id)">Artist</a>
                    <a id="Genre" href="#" onclick="SelectQueryType(this.id)">Genre</a>
                    <a id="Playlist" href="#" onclick="SelectQueryType(this.id)">Playlist</a>
                </div>
            </div>
            <div class="searchbar">
                <form>
                    <input class="searchQuery" type="text" id="search" disabled oninput="SearchInput()">
                </form>
            </div>
        </div>
        <div class="activate">
                <button id="power_hour" disabled onclick="MakePowerHour()">Make me a Power Hour!</button>
        </div>
    
    </body>
</html>
